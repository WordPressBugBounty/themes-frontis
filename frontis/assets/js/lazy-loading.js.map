{"version":3,"file":"assets/js/lazy-loading.js","mappings":"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","sources":["webpack://frontis/./src/frontend/lazy-loading.js"],"sourcesContent":["class FrontisImageOptimizer {\n  constructor(config = {}) {\n    this.config = {\n      lazyOffset: 50,\n      imageQuality: 85,\n      placeholder: {\n        color: '#F1F1F1',\n        blurHashLevel: 4\n      },\n      screens: {\n        sm: 640,\n        md: 768,\n        lg: 1024,\n        xl: 1280,\n        '2xl': 1536\n      },\n      cdnUrl: config.cdnUrl || '',\n      ...config\n    };\n\n    this.processedImages = new WeakSet();\n    this.processedVideos = new WeakSet();\n    this.init();\n  }\n\n  init() {\n    // Priority loading for LCP elements\n    this.processLCPElements();\n    \n    // Then handle other elements\n    if (document.readyState === 'complete') {\n      this.setupLazyLoading();\n    } else {\n      window.addEventListener('load', () => this.setupLazyLoading());\n    }\n  }\n\n  // New method to handle LCP elements\n  processLCPElements() {\n    // Get potential LCP elements\n    const lcpElements = this.identifyLCPElements();\n    \n    // Process them immediately with high priority\n    lcpElements.forEach(element => {\n      if (element.tagName === 'IMG') {\n        this.processLCPImage(element);\n      } else if (element.tagName === 'H1' || element.tagName === 'H2') {\n        this.optimizeHeading(element);\n      } else if (element.hasAttribute('data-frontis-bg')) {\n        this.processLCPBackground(element);\n      }\n    });\n  }\n\n  // Identify potential LCP elements\n  identifyLCPElements() {\n    const elements = [];\n    \n    // First meaningful heading\n    const mainHeading = document.querySelector('h1, h2');\n    if (mainHeading) elements.push(mainHeading);\n\n    // Hero image or first large image\n    const heroImage = document.querySelector('.hero img, .banner img, header img');\n    if (heroImage) elements.push(heroImage);\n\n    // Large above-the-fold images\n    const aboveFoldImages = Array.from(document.querySelectorAll('img')).filter(img => {\n      const rect = img.getBoundingClientRect();\n      return rect.top < window.innerHeight && rect.width > 200 && rect.height > 200;\n    });\n    elements.push(...aboveFoldImages);\n\n    return elements;\n  }\n\n  // Process LCP images with high priority\n  async processLCPImage(img) {\n    if (this.processedImages.has(img)) return;\n\n    const originalSrc = img.getAttribute('src') || img.getAttribute('data-src');\n    if (!originalSrc) return;\n\n    try {\n      // Preload the image\n      const preloadLink = document.createElement('link');\n      preloadLink.rel = 'preload';\n      preloadLink.as = 'image';\n      preloadLink.href = originalSrc;\n      document.head.appendChild(preloadLink);\n\n      const dimensions = await this.getImageSize(originalSrc);\n      const optimizedSrc = this.getOptimizedUrl(originalSrc, {\n        quality: 90, // Higher quality for LCP images\n        width: dimensions.width\n      });\n\n      // Load immediately without placeholder\n      img.src = optimizedSrc;\n      img.setAttribute('width', dimensions.width);\n      img.setAttribute('height', dimensions.height);\n      img.style.aspectRatio = `${dimensions.width} / ${dimensions.height}`;\n      \n      // Add fetchpriority=\"high\" for browsers that support it\n      img.setAttribute('fetchpriority', 'high');\n      \n      this.processedImages.add(img);\n\n    } catch (error) {\n      console.warn('Frontis: Error processing LCP image:', error);\n    }\n  }\n\n  // Optimize headings that might be LCP\n  optimizeHeading(heading) {\n    // Ensure text is visible immediately\n    heading.style.display = 'block';\n    \n    // Add font-display: swap if using custom fonts\n    const style = document.createElement('style');\n    style.textContent = `\n      ${heading.tagName.toLowerCase()} {\n        font-display: swap !important;\n      }\n    `;\n    document.head.appendChild(style);\n  }\n\n  // Process LCP background images\n  async processLCPBackground(element) {\n    if (this.processedImages.has(element)) return;\n\n    const bgUrl = element.getAttribute('data-frontis-bg') || this.getBgImageUrl(element);\n    if (!bgUrl) return;\n\n    try {\n      // Preload the background image\n      const preloadLink = document.createElement('link');\n      preloadLink.rel = 'preload';\n      preloadLink.as = 'image';\n      preloadLink.href = bgUrl;\n      document.head.appendChild(preloadLink);\n\n      // Apply optimized background immediately\n      const optimizedUrl = this.getOptimizedUrl(bgUrl, {\n        quality: 90 // Higher quality for LCP elements\n      });\n      \n      element.style.backgroundImage = `url(\"${optimizedUrl}\")`;\n      this.processedImages.add(element);\n\n    } catch (error) {\n      console.warn('Frontis: Error processing LCP background:', error);\n    }\n  }\n\n  // Rest of the methods remain the same...\n  setupLazyLoading() {\n    this.setupObserver();\n    this.processImages();\n    this.processVideos();\n    this.watchDOM();\n  }\n\n  // ... (include all other methods from previous implementation)\n}\n\n// Initialize with LCP optimization\nexport default FrontisImageOptimizer;\n\nconst frontisOptimizer = new FrontisImageOptimizer({\n  lazyOffset: 100,\n  placeholder: {\n    color: '#E2E2E2',\n    blurHashLevel: 4\n  }\n});"],"names":["FrontisImageOptimizer","constructor","config","this","lazyOffset","imageQuality","placeholder","color","blurHashLevel","screens","sm","md","lg","xl","cdnUrl","processedImages","WeakSet","processedVideos","init","processLCPElements","document","readyState","setupLazyLoading","window","addEventListener","identifyLCPElements","forEach","element","tagName","processLCPImage","optimizeHeading","hasAttribute","processLCPBackground","elements","mainHeading","querySelector","push","heroImage","aboveFoldImages","Array","from","querySelectorAll","filter","img","rect","getBoundingClientRect","top","innerHeight","width","height","has","originalSrc","getAttribute","preloadLink","createElement","rel","as","href","head","appendChild","dimensions","getImageSize","optimizedSrc","getOptimizedUrl","quality","src","setAttribute","style","aspectRatio","add","error","console","warn","heading","display","textContent","toLowerCase","bgUrl","getBgImageUrl","optimizedUrl","backgroundImage","setupObserver","processImages","processVideos","watchDOM"],"sourceRoot":""}